"use strict";(self.webpackChunkwhg_training_resources=self.webpackChunkwhg_training_resources||[]).push([[5229],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>u});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},m=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},g=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=p(a),g=r,u=c["".concat(l,".").concat(g)]||c[g]||d[g]||i;return a?n.createElement(u,o(o({ref:t},m),{},{components:a})):n.createElement(u,o({ref:t},m))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=g;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}g.displayName="MDXCreateElement"},8060:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const i={sidebar_position:1},o="Reading results from a sqlite file in any language",s={unversionedId:"programming/programming_with_gene_annotations3/appendices/sqlite_access",id:"programming/programming_with_gene_annotations3/appendices/sqlite_access",title:"Reading results from a sqlite file in any language",description:"In the tutorial you wrote a command-line program to [convert the data into sqlite3",source:"@site/docs/programming/programming_with_gene_annotations3/appendices/sqlite_access.md",sourceDirName:"programming/programming_with_gene_annotations3/appendices",slug:"/programming/programming_with_gene_annotations3/appendices/sqlite_access",permalink:"/whg-training-resources/programming/programming_with_gene_annotations3/appendices/sqlite_access",draft:!1,editUrl:"https://github.com/whg-training/whg-training-resources/edit/main/docs/programming/programming_with_gene_annotations3/appendices/sqlite_access.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"sidebar5",previous:{title:"Challenge questions",permalink:"/whg-training-resources/programming/programming_with_gene_annotations3/challenge_questions"},next:{title:"Refactor for better readability",permalink:"/whg-training-resources/programming/programming_with_gene_annotations3/appendices/refactoring"}},l={},p=[{value:"The command-line",id:"the-command-line",level:2},{value:"Python",id:"python",level:2},{value:"R",id:"r",level:2},{value:"Julia",id:"julia",level:2},{value:"On the web",id:"on-the-web",level:2}],m={toc:p},c="wrapper";function d(e){let{components:t,...a}=e;return(0,r.kt)(c,(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"reading-results-from-a-sqlite-file-in-any-language"},"Reading results from a sqlite file in any language"),(0,r.kt)("p",null,"In the tutorial you wrote a command-line program to ",(0,r.kt)("a",{parentName:"p",href:"008_Converting_gff_to_sqlite.md"},"convert the data into sqlite3\nformat"),".  One of the cool things about this is that it makes it easy to access the data\nin any language we like - without really any extra effort.  This page demonstrates a few options. "),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"For the commands on this page to work, you'll have to have used your ",(0,r.kt)("inlineCode",{parentName:"p"},"gff_to_sqlite.R")," / ",(0,r.kt)("inlineCode",{parentName:"p"},"gff_to_sqlite.R")," program to\ncreate a ",(0,r.kt)("inlineCode",{parentName:"p"},"genes.sqlite")," file containing some data imported from a gff file.  If not, ",(0,r.kt)("a",{parentName:"p",href:"/whg-training-resources/programming/programming_with_gene_annotations3/Converting_gff_to_sqlite"},"run the relevant\ntutorial")," first."))),(0,r.kt)("h2",{id:"the-command-line"},"The command-line"),(0,r.kt)("p",null,"To use the results from the command-line, you can use the ",(0,r.kt)("a",{parentName:"p",href:"www.sqlite.org"},"sqlite3 command-line client")," to print\nthe contents:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'sqlite3 genes.sqlite "SELECT * FROM gff" | less -S\n')),(0,r.kt)("p",null,"This output format is probably not quite what you wanted. However, sqlite gives us lots of tools for getting the\nbit of data we want and in the right format. For example to output the locaitons of all the genes in a columnar\nformat:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sqlite3 -header -column genes.sqlite \"SELECT analysis, seqid, start, end, strand FROM gff WHERE type == 'gene'\"\n")),(0,r.kt)("p",null,"Or to get a line-based output of all transcripts of the ",(0,r.kt)("em",{parentName:"p"},"ABO")," gene:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sqlite3 -line genes.sqlite \"SELECT * FROM gff WHERE type == 'transcript' AND attributes LIKE '%Name=ABO%'\"\n")),(0,r.kt)("p",null,"Or if you want just the first few lines in CSV format:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'sqlite3 -csv -header genes.sqlite "SELECT * FROM gff LIMIT 10"\n')),(0,r.kt)("p",null,"Or just records for ",(0,r.kt)("em",{parentName:"p"},"FUT2")," in tab-separated format:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sqlite3 -separator $'\\t' -header genes.sqlite \"SELECT * FROM gff WHERE ID=='ENSG00000176920.13' Or Parent == 'ENSG00000176920.13'\"\n")),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"These same queries can of course be used with the languages below, too."))),(0,r.kt)("p",null,"Using the ",(0,r.kt)("inlineCode",{parentName:"p"},"sqlite3"),' tool, you can also see the whole database "schema" like so:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'% sqlite3 genes.sqlite ".schema"\n')),(0,r.kt)("p",null,"You should see one table (",(0,r.kt)("inlineCode",{parentName:"p"},"gff"),") and the two indexes we created."),(0,r.kt)("h2",{id:"python"},"Python"),(0,r.kt)("p",null,"Loading results in python is easy too using the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.python.org/3/library/sqlite3.html"},(0,r.kt)("inlineCode",{parentName:"a"},"sqlite3")," module"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'import pandas, sqlite3\ndb = sqlite3.connect( "genes.sqlite" )\ndata = pandas.read_sql( "SELECT * FROM gff WHERE type==\'gene\'", db )\nprint(data)\n')),(0,r.kt)("h2",{id:"r"},"R"),(0,r.kt)("p",null,"To load results in R, use the ",(0,r.kt)("a",{parentName:"p",href:"https://cran.r-project.org/web/packages/RSQLite/index.html"},"RSQLite")," package:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-R"},'library( RSQLite )\ndb = dbConnect( dbDriver( "SQLite" ), "genes.sqlite" )\ndata = dbGetQuery( db, "SELECT * FROM gff WHERE type==\'gene\'" )\nprint( data )\n')),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"This produces an R 'data frame'.  If you want a tidyverse tibble, load the tidyverse library and convert it:"),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre"},"data = as_tibble( data )\n")))),(0,r.kt)("h2",{id:"julia"},"Julia"),(0,r.kt)("p",null,"In Julia this is easy using the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/JuliaDatabases/SQLite.jl"},(0,r.kt)("inlineCode",{parentName:"a"},"SQLite.jl")," package"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-julia"},'using SQLite, DataFrames\ndb = SQLite.DB( "genes.sqlite" )\nDBInterface.execute( db, "SELECT * FROM gff WHERE type==\'gene\'" ) |> DataFrame\n')),(0,r.kt)("h2",{id:"on-the-web"},"On the web"),(0,r.kt)("p",null,"It's also possible to serve the database over the web - using ",(0,r.kt)("a",{parentName:"p",href:"https://datasette.io"},"datasette"),".\nAssuming you are using ",(0,r.kt)("a",{parentName:"p",href:"/whg-training-resources/prerequisites/CONDA"},"conda"),", you may be able to install datasette like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"mamba install datasette\n")),(0,r.kt)("p",null,"To serve the database to your local machine, type:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"datasette serve genes.sqlite\n")),(0,r.kt)("p",null,"This starts the server process in your terminal. Visit ",(0,r.kt)("a",{parentName:"p",href:"http://127.0.0.1:8001"},"http://127.0.0.1:8001")," in your browser, and browse away!\n(Press Ctrl-C in your terminal to quit the server process when you're done.)"),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"For example, I used datasette and ",(0,r.kt)("a",{parentName:"p",href:"/whg-training-resources/prerequisites/Other_languages/javascript"},"javascript visualisation")," to create the\nfigures for our paper (Malaria protection due to sickle haemoglobin depends on parasite\ngenotype)","[https://www.nature.com/articles/s41586-021-04288-3]","."))))}d.isMDXComponent=!0}}]);