"use strict";(self.webpackChunkwhg_training_resources=self.webpackChunkwhg_training_resources||[]).push([[7777],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>h});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=a.createContext({}),s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=s(t),m=r,h=d["".concat(p,".").concat(m)]||d[m]||c[m]||i;return t?a.createElement(h,o(o({ref:n},u),{},{components:t})):a.createElement(h,o({ref:n},u))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=m;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l[d]="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},3750:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var a=t(7462),r=(t(7294),t(3905));const i={sidebar_position:5},o="ADMIXTURE analysis",l={unversionedId:"population_genetics/admixture_and_biobanks/admixture",id:"population_genetics/admixture_and_biobanks/admixture",title:"ADMIXTURE analysis",description:"ADMIXTURE is among many other software (e.g. STRUCTURE) that perform clustering based on genotyping data to infer",source:"@site/docs/population_genetics/admixture_and_biobanks/admixture.md",sourceDirName:"population_genetics/admixture_and_biobanks",slug:"/population_genetics/admixture_and_biobanks/admixture",permalink:"/whg-training-resources/population_genetics/admixture_and_biobanks/admixture",draft:!1,editUrl:"https://github.com/whg-training/whg-training-resources/edit/main/docs/population_genetics/admixture_and_biobanks/admixture.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"sidebar7",previous:{title:"Principal component analysis of the 1000 Genomes Project",permalink:"/whg-training-resources/population_genetics/admixture_and_biobanks/pca"}},p={},s=[{value:"Generating the input file for ADMIXTURE",id:"generating-the-input-file-for-admixture",level:2},{value:"Running ADMIXTURE",id:"running-admixture",level:2},{value:"Setting up R environment",id:"setting-up-r-environment",level:2}],u={toc:s},d="wrapper";function c(e){let{components:n,...t}=e;return(0,r.kt)(d,(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"admixture-analysis"},"ADMIXTURE analysis"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ADMIXTURE")," is among many other software (e.g. STRUCTURE) that perform clustering based on genotyping data to infer\npopulations and individual ancestries.  It is more ",(0,r.kt)("strong",{parentName:"p"},"model-based")," than PCA (which after all just pulls out 'directions'\nin space that maximise variance) - it models the input populations in terms of some set of unknown 'ancestral'\npopulations, with admixture between them.  Then for each individual it outputs an estimate of how much of their genome\nis from each ancestral population."),(0,r.kt)("p",null,"You can download the software ",(0,r.kt)("a",{parentName:"p",href:"https://dalexander.github.io/admixture/download.html"},"at the ADMIXTURE github page"),". You\ncan also ",(0,r.kt)("a",{parentName:"p",href:"https://dalexander.github.io/admixture/admixture-manual.pdf"},"read the manual"),"."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If you receive 'Cannot Be Opened Because the Developer Cannot be Verified' Error on Mac, you can try the following:"),(0,r.kt)("ol",{parentName:"div"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Open ",(0,r.kt)("inlineCode",{parentName:"p"},"Finder"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Locate ADMIXTURE software you\u2019re trying to open.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Control+Click")," the app.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select Open.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click Open."))),(0,r.kt)("p",{parentName:"div"},"The app should be saved as an exception in your security settings, allowing you to open it in the future."))),(0,r.kt)("p",null,"Let's try running ADMIXTURE now."),(0,r.kt)("h2",{id:"generating-the-input-file-for-admixture"},"Generating the input file for ADMIXTURE"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ADMIXTURE")," requires unlinked (i.e. LD-pruned) SNPs in PLINK format. Good news, since we'ce ",(0,r.kt)("a",{parentName:"p",href:"/whg-training-resources/population_genetics/admixture_and_biobanks/getting_setup"},"already generated a set\nlike that"),"."),(0,r.kt)("p",null,"Previously, we've output the pruned file (1000 Genomes Chromosome 21) into the vcf format, but for ADMIXTURE we need to\nconvert them into PLINK (.bed/bim/fam) format.  Let's do that now using PLINK:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"# Generate the input file in plink format\n./plink2 \\\n--vcf g1k_chr21_pruned.vcf.gz \\\n--snps-only \\\n--max-alleles 2 \\\n--make-bed \\\n--out g1k_chr21_pruned\n\n")),(0,r.kt)("h2",{id:"running-admixture"},"Running ADMIXTURE"),(0,r.kt)("p",null,"Now, we are ready to run ADMIXTURE. We will run it with cross-validation (the default is 5-fold CV, for higher, choose\ne.g. cv=10) and ",(0,r.kt)("inlineCode",{parentName:"p"},"K=3"),". ",(0,r.kt)("inlineCode",{parentName:"p"},"K")," here is the number of clusters, i.e., ancestral populations that you might have. ",(0,r.kt)("inlineCode",{parentName:"p"},"Bonus"),": Try\nother values (2,3,4,5,6, etc) and see what you have! "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"admixture --cv g1k_chr21_pruned.bed 3 > admixture_k3.out # saves the log file\n")),(0,r.kt)("p",null,"After running this command, you now should have two new files appear in the same directory! "),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"g1k_chr21_pruned.3.P")," contains for each SNP the population allele frequency"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"g1k_chr21_pruned.3.Q")," contains cluster assignment for each individual, this is what we usually need for admixture plotting"),(0,r.kt)("h1",{id:"plotting-in-r"},"Plotting in R"),(0,r.kt)("p",null,"Now we are ready to plot a typical ADMIXTURE-barplot for ",(0,r.kt)("inlineCode",{parentName:"p"},"K=3"),":"),(0,r.kt)("h2",{id:"setting-up-r-environment"},"Setting up R environment"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-r"},'# load library\nlibrary("tidyverse")\n\n# read in data\nadx <- read.table("g1k_chr21_pruned.3.Q",h=F)\nnames(adx) <- c("K1","K2","K3")\nfam <- read.table("g1k_chr21_pruned.fam",h=F)\n\n# rename samples\nsamples <- unlist(lapply(fam$V2, function(x) unlist(strsplit(x, split = "_"))[1]))\n\n# admixture individuals that the same order at the input fam file\nadx$sample <- samples\n\n# to group/confirm/understand our ADMIXTURE results we can also assign their ancestry\npop <- read.table("integrated_call_samples_v3.20130502.ALL.panel", header = TRUE, stringsAsFactors = FALSE )\n\nadx$ancestry <- pop[ match(adx$sample,pop$sample),]$super_pop\n\n# Now we are ready to plot\npop_colors <- c("#1D72F5","#77CE61", "#FF9326") \npop_labels <- c("African","East Asian","European")\n\nbarplot(t(as.matrix(adx[,1:3])), col = pop_colors, ylab = "Ancestry Proportion",border=NA)\n')),(0,r.kt)("h1",{id:"looking-a-bit-messy-lets-reorder-the-samples"},"Looking a bit messy? Let's reorder the samples!"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-r"},"pltDf <- adx %>% \n  mutate(id = row_number()) %>% \n  gather('pop', 'prob', K1:K3) %>% \n  group_by(id) %>% \n  mutate(likely_assignment = pop[which.max(prob)],\n         assingment_prob = max(prob)) %>% \n  arrange(likely_assignment, desc(assingment_prob)) %>% \n  ungroup() %>% \n  mutate(id = forcats::fct_inorder(factor(id)))\n\nggplot(pltDf , aes(id, prob, fill = pop)) +\n  geom_col() +\n  theme_classic()  + \n  facet_grid(~ancestry, scales = 'free', space = 'free') +\n  theme(\n    axis.title.x = element_blank(),\n    axis.text.x = element_blank(),\n    axis.ticks.x = element_blank(),\n    legend.position = \"none\"\n  ) +\n  scale_fill_manual(values=pop_colors) +\n  ylab(\"Ancestry Proportion\")\n")),(0,r.kt)("p",null,"N.B. There are many packages in R that can do this job with varying number of K, and in more complicated settings, such\nas ",(0,r.kt)("a",{parentName:"p",href:"https://www.royfrancis.com/pophelper/"},"pophelper"),"."),(0,r.kt)("p",null,"Congratulations!  You have now completed an ADMIXTURE analysis!"))}c.isMDXComponent=!0}}]);