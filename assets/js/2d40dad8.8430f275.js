"use strict";(self.webpackChunkwhg_training_resources=self.webpackChunkwhg_training_resources||[]).push([[8046],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,s=e.originalType,l=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),m=p(n),h=i,d=m["".concat(l,".").concat(h)]||m[h]||c[h]||s;return n?a.createElement(d,o(o({ref:t},u),{},{components:n})):a.createElement(d,o({ref:t},u))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var s=n.length,o=new Array(s);o[0]=h;var r={};for(var l in t)hasOwnProperty.call(t,l)&&(r[l]=t[l]);r.originalType=e,r[m]="string"==typeof e?e:i,o[1]=r;for(var p=2;p<s;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},5703:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>s,metadata:()=>r,toc:()=>p});var a=n(7462),i=(n(7294),n(3905));const s={sidebar_position:3},o="Using FINEMAP to fine-map associations",r={unversionedId:"genome_wide_association_studies/meta-analysis_and_fine-mapping/Fine-mapping",id:"genome_wide_association_studies/meta-analysis_and_fine-mapping/Fine-mapping",title:"Using FINEMAP to fine-map associations",description:"Up to the table of contents / Back to the meta-analysis section",source:"@site/docs/genome_wide_association_studies/meta-analysis_and_fine-mapping/Fine-mapping.md",sourceDirName:"genome_wide_association_studies/meta-analysis_and_fine-mapping",slug:"/genome_wide_association_studies/meta-analysis_and_fine-mapping/Fine-mapping",permalink:"/whg-training-resources/genome_wide_association_studies/meta-analysis_and_fine-mapping/Fine-mapping",draft:!1,editUrl:"https://github.com/whg-training/whg-training-resources/edit/main/docs/genome_wide_association_studies/meta-analysis_and_fine-mapping/Fine-mapping.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"sidebar8",previous:{title:"Meta-analysing two studies.",permalink:"/whg-training-resources/genome_wide_association_studies/meta-analysis_and_fine-mapping/Meta-analysis"}},l={},p=[{value:"Preparing FINEMAP input files",id:"preparing-finemap-input-files",level:2},{value:"Running FINEMAP",id:"running-finemap",level:2},{value:"Interpreting FINEMAP output",id:"interpreting-finemap-output",level:3},{value:"The FINEMAP log file.",id:"the-finemap-log-file",level:3},{value:"The causal configurations output file",id:"the-causal-configurations-output-file",level:3},{value:"The SNP file",id:"the-snp-file",level:3},{value:"The credible sets file",id:"the-credible-sets-file",level:3},{value:"Plotting FINEMAP output.",id:"plotting-finemap-output",level:2},{value:"Conclusion",id:"conclusion",level:2}],u={toc:p},m="wrapper";function c(e){let{components:t,...s}=e;return(0,i.kt)(m,(0,a.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"using-finemap-to-fine-map-associations"},"Using FINEMAP to fine-map associations"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/genome_wide_association_studies/meta-analysis_and_fine-mapping/"},"Up to the table of contents")," / ",(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/genome_wide_association_studies/meta-analysis_and_fine-mapping/Meta-analysis"},"Back to the meta-analysis section")),(0,i.kt)("p",null,"If you followed the ",(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/genome_wide_association_studies/meta-analysis_and_fine-mapping/Meta-analysis"},"meta-analysis section")," you should now have a dataframe with meta-analysis results.  It looks something like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"> meta_analysis\n# A tibble: 730 x 16\n   rsid             chromosome position allele1 allele2 study1.beta study1.se   study1.P log10_study1.BF study2.beta study2.se study2.P meta.beta meta.se   meta.P log10_meta.BF\n   <chr>                 <dbl>    <dbl> <chr>   <chr>         <dbl>     <dbl>      <dbl>           <dbl>       <dbl>     <dbl>    <dbl>     <dbl>   <dbl>    <dbl>         <dbl>\n 1 19:49149607:G:A          19 49149607 G       A            0.202     0.228  0.376              -0.0925     -0.146      0.295  0.310      0.0176  0.0894 8.44e- 1       -0.0497\n 2 19:49149711:G:A          19 49149711 G       A           -0.0183    0.202  0.928               0.0195      0.239      0.261  0.180      0.0245  0.0894 7.84e- 1       -0.0668\n 3 19:49149937:T:G          19 49149937 T       G           -0.357     0.0785 0.00000540          4.90       -0.264      0.101  0.00463   -0.669   0.0894 7.45e-14       12.3   \n 4 19:49150048:G:T          19 49150048 G       T           -0.332     0.0788 0.0000257           4.26       -0.271      0.102  0.00387   -0.636   0.0894 1.12e-12       11.2   \n 5 19:49150130:G:T          19 49150130 G       T           -0.196     0.110  0.0756              0.947      -0.204      0.143  0.0767    -0.209   0.0894 1.96e- 2        1.52  \n 6 19:49150233:G:A          19 49150233 G       A            0.133     0.134  0.321              -0.137      -0.0794     0.173  0.323      0.0381  0.0894 6.70e- 1       -0.0958\n 7 19:49151312:C:T          19 49151312 C       T            0.238     0.145  0.101              -0.137       0.101      0.187  0.295      0.114   0.0894 2.03e- 1       -0.176 \n 8 19:49151323:T:G          19 49151323 T       G            0.202     0.228  0.376              -0.0925     -0.146      0.295  0.310      0.0176  0.0894 8.44e- 1       -0.0497\n 9 19:49151460:C:CA         19 49151460 C       CA          -0.283     0.153  0.0636              0.936      -0.218      0.197  0.134     -0.142   0.0894 1.12e- 1        0.830 \n10 19:49152118:C:T          19 49152118 C       T           -0.609     0.328  0.0632              0.634      -0.604      0.423  0.0767    -0.0723  0.0894 4.19e- 1        0.319 \n")),(0,i.kt)("p",null,"We can look at the strongest signals in the data (either by P-value or Bayes factor) and compare across the studies and the meta-analysis."),(0,i.kt)("p",null,"However, ",(0,i.kt)("strong",{parentName:"p"},"what if there are multiple causal variants in the region"),"?"),(0,i.kt)("p",null,"If there are, then the single-SNP estimate at each SNP we see above would be a combination of several things:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"A contribution from the true, causal effect of the SNP.  (This will be zero if the SNP doesn't have a causal effect)"),(0,i.kt)("li",{parentName:"ul"},"A contribution from sampling noise (represented in the standard error)"),(0,i.kt)("li",{parentName:"ul"},"A contribution from other causal SNPs that happen to be in linkage disequilibrium (i.e. correlated) with this SNP.")),(0,i.kt)("p",null,"Moreover it is possible that looking at the 'top' SNPs as above could be misleading in this case\n(for example, if there were a SNP that is in strong LD with two causal SNPs, it might have an\napparent strong effect.)"),(0,i.kt)("p",null,"In this part of the practical we will use the ",(0,i.kt)("a",{parentName:"p",href:"https:/www.finemap.me"},(0,i.kt)("inlineCode",{parentName:"a"},"FINEMAP"))," tool to fit a model that allows for multiple\npossbile causal SNPs."),(0,i.kt)("h2",{id:"preparing-finemap-input-files"},"Preparing FINEMAP input files"),(0,i.kt)("p",null,"To run finemap, we need to set up some input files in ",(0,i.kt)("a",{parentName:"p",href:"https:/www.finemap.me"},"the particular format that FINEMAP needs"),".\n",(0,i.kt)("inlineCode",{parentName:"p"},"FINEMAP")," takes:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"A set of per-SNP summary statistics (betas and standard errors) from the study. To maximise\npower, we will use your meta-analysed results here.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"A matrix of between-SNP linkage disquilibrium (correlation) values.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"It also requires us to specify the sample size - in our study the sample sizes were 12,500 (study\n1) and 7,500 (study 2), so the total sample size is 20,000."))),(0,i.kt)("p",null,"We have precomputed the LD values for you in the file ",(0,i.kt)("a",{target:"_blank",href:n(4926).Z},(0,i.kt)("code",null,"study_LD.ld")),". (It is a giant\n",(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("mn",{parentName:"mrow"},"730"),(0,i.kt)("mo",{parentName:"mrow"},"\xd7"),(0,i.kt)("mn",{parentName:"mrow"},"730")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"730 \\times 730")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.7278em",verticalAlign:"-0.0833em"}}),(0,i.kt)("span",{parentName:"span",className:"mord"},"730"),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.kt)("span",{parentName:"span",className:"mbin"},"\xd7"),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222em"}})),(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.6444em"}}),(0,i.kt)("span",{parentName:"span",className:"mord"},"730")))))," matrix represented in a text file). But we need to make a file of meta-analysis\nresults."),(0,i.kt)("p",null,"If you look at ",(0,i.kt)("a",{parentName:"p",href:"https:/www.finemap.me"},"the documentation")," you'll see that FINEMAP needs a\nspace-separated file with these columns: rsid, chromosome, position, allele1, allele2, maf, beta,\nse. The only thing we don't have that we need right now is the ",(0,i.kt)("em",{parentName:"p"},"minor allele frequency"),". So let's\ncompute this first using the minor allele frequencies from the two studies and their sample sizes\n(which in this data are study1: 12,500 and study2: 7,500):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"meta_analysis$maf = ((study1$maf * 12500) + (study2$maf * 7500)) / (20000)\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note.")," The above calculation is ",(0,i.kt)("strong",{parentName:"p"},"dangerous"),": it would be wrong if the minor allele is not the\nsame in the two studies. For this data we happen to know that is not the case, but in real data you\nshould always aim to ",(0,i.kt)("strong",{parentName:"p"},"compute the allele frequency of a specific allele")," instead."),(0,i.kt)("p",null,"Now let's write a FINEMAP input file:"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Still in your R / RStudio session"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'# format the data...\nfinemap.data = meta_analysis[,\n    c( "rsid", "chromosome", "position", "allele1", "allele2",\n    "maf", "meta.beta", "meta.se" )\n]\ncolnames( finemap.data )[7:8] = c( "beta", "se" )\n\n# ...and write it to a file\nwrite_delim( finemap.data, "combined_study.z", delim = " ")\n')),(0,i.kt)("p",null,"To get ",(0,i.kt)("inlineCode",{parentName:"p"},"FINEMAP")," to run we also have to give it another input file telling it what all the input\nand output files are. This one is a bit weird: it is a ",(0,i.kt)("em",{parentName:"p"},"semi-colon delimited")," text file. Create a\nnew file called ",(0,i.kt)("inlineCode",{parentName:"p"},"finemap.master")," and put this in:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"z;ld;snp;config;cred;log;n_samples\ncombined_study.z;study_LD.ld;finemap_meta.snp;finemap_meta.config;finemap_meta.cred;finemap_meta.log;20000\n")),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The format of the file is ",(0,i.kt)("a",{parentName:"p",href:"http://www.christianbenner.com/#input"},"described here"),". What input files are we using?\nWhat output files have we specified? What's the number ",(0,i.kt)("inlineCode",{parentName:"p"},"20000"),"?"))),(0,i.kt)("p",null,"Now you are ready to run ",(0,i.kt)("inlineCode",{parentName:"p"},"FINEMAP"),"..."),(0,i.kt)("h2",{id:"running-finemap"},"Running FINEMAP"),(0,i.kt)("p",null,"I'm going to assume you have downloaded and been able to run ",(0,i.kt)("inlineCode",{parentName:"p"},"FINEMAP")," as described in the\n",(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/genome_wide_association_studies/meta-analysis_and_fine-mapping/Introduction"},"Introduction"),". (If not please go and download it now.) Hopefully you know where\nit is and can run it with a command of the following form. (",(0,i.kt)("strong",{parentName:"p"},"Note.")," in this section we are back\nto working on the command-line - these are not R commands!)  Try this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/path/to/finemap_v[version]/finemap_v[version]\n")),(0,i.kt)("p",null,"For example, on my older Mac OS system I had to use finemap v1.3, so running it looks like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ /path/to/finemap_v1.3.1_MacOSX/finemap_v1.3.1_MacOSX \n\n|--------------------------------------|\n| Welcome to FINEMAP v1.3.1            |\n|                                      |\n| (c) 2015-2018 University of Helsinki |\n|                                      |\n| Help :                               |\n| - ./finemap --help                   |\n| - www.finemap.me                     |\n| - www.christianbenner.com            |\n|                                      |\n| Contact :                            |\n| - christian.benner@helsinki.fi       |\n| - matti.pirinen@helsinki.fi          |\n|--------------------------------------|\n\nError : No flags detected!\n")),(0,i.kt)("p",null,"For ease of use, I suggest to copy the finemap executable into the current directory:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"cp /path/to/finemap_v[version]/finemap_v[version] ./finemap\n")),(0,i.kt)("p",null,"Running FINEMAP is hopefully now easy:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"./finemap --sss --in-files finemap.master --log\n")),(0,i.kt)("p",null,"Be prepared for a bit of a wait as FINEMAP searches the space of possible causal configurations."),(0,i.kt)("p",null,"So what ",(0,i.kt)("em",{parentName:"p"},"is")," FINEMAP doing? Well, you can read the ",(0,i.kt)("a",{parentName:"p",href:"https://doi.org/10.1093/bioinformatics/btw018"},"FINEMAP paper"),", but in\nshort: finemap conducts a ",(0,i.kt)("em",{parentName:"p"},"shotgun stochastic search")," around the space of possible causal configurations (groups of SNPs that\nmight be causal). It starts off with all single-SNP models, then it randomly tries a bunch of ways of adding a second SNP to\nthe first (picking the best model). Then it keeps going randomly trying to add or remove SNPs so that it explores the space of\nconfigurations that have high probability."),(0,i.kt)("p",null,"In general it would need the raw genotype data to do this. However, because it assumes an additive\nmodel (of genotypes on phenotype) it turns out that an approximation based on the SNP effects and\nld is sufficient, which is how FINEMAP can run so fast."),(0,i.kt)("h3",{id:"interpreting-finemap-output"},"Interpreting FINEMAP output"),(0,i.kt)("p",null,"Your run of FINEMAP should have produced several output files (the ones you named in your\n",(0,i.kt)("inlineCode",{parentName:"p"},"finemap.master")," file):"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"A 'configurations' file (",(0,i.kt)("inlineCode",{parentName:"li"},"finemap_meta.config"),"), listing the causal configurations that FINEMAP thinks are plausible."),(0,i.kt)("li",{parentName:"ul"},"A 'credible intervals' file, (",(0,i.kt)("inlineCode",{parentName:"li"},"finemap_meta.cred"),") listing variants wiht high probabilty of being the causal SNP for each signal in the top configuration."),(0,i.kt)("li",{parentName:"ul"},"A 'SNP' file (",(0,i.kt)("inlineCode",{parentName:"li"},"finemap_meta.snp"),"), listing the evidence that each SNP is one of the causal ones across configurations"),(0,i.kt)("li",{parentName:"ul"},"And a log file (",(0,i.kt)("inlineCode",{parentName:"li"},"finemap_meta.log"),") telling you what it has done.")),(0,i.kt)("p",null,"Let's look at these files now."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note.")," If for whatever reason you couldn't get FINEMAP to run, you can use my output files which\nare in the ",(0,i.kt)("a",{parentName:"p",href:"solutions/"},(0,i.kt)("inlineCode",{parentName:"a"},"solutions"))," folder."),(0,i.kt)("h3",{id:"the-finemap-log-file"},"The FINEMAP log file."),(0,i.kt)("p",null,"Before you look at the output files, look at the results FINEMAP prints to stdout when you run it\n(and saves to the .log_sss file). Mine looks like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"|--------------------------------------|\n| Welcome to FINEMAP v1.3.1            |\n|                                      |\n| (c) 2015-2018 University of Helsinki |\n|                                      |\n| Help :                               |\n| - ./finemap --help                   |\n| - www.finemap.me                     |\n| - www.christianbenner.com            |\n|                                      |\n| Contact:                             |\n| - christian.benner@helsinki.fi       |\n| - matti.pirinen@helsinki.fi          |\n|--------------------------------------|\n\n--------\nSETTINGS\n--------\n- dataset         : all\n- corr-config     : 0.95\n- n-causal-snps   : 5\n- n-configs-top   : 50000\n- n-convergence   : 1000\n- n-iterations    : 100000\n- prior-k0        : 0\n- prior-std       : 0.05 \n- prob-tol        : 0.001\n\n------------\nFINE-MAPPING (1/1)\n------------\n- GWAS summary stats               : combined_study.z\n- SNP correlations                 : study_LD.ld\n- Causal SNP stats                 : finemap_meta.snp\n- Causal configurations            : finemap_meta.config\n- Credible sets                    : finemap_meta.cred\n- Log file                         : finemap_meta.log_sss\n\n- Number of GWAS samples           : 20000\n- Number of SNPs                   : 730\n- Prior-Pr(# of causal SNPs is k)  : \n  (0 -> 0)\n   1 -> 0.583\n   2 -> 0.291\n   3 -> 0.097\n   4 -> 0.0242\n   5 -> 0.00482\n- 757559 configurations evaluated (1.152/100%) : converged after 1152 iterations\n- Regional SNP heritability        : 0.00486 (SD: 0.000961 ; 95% CI: [0.00316,0.00689])\n- Log10-BF of >= one causal SNP    : 14.3\n- Post-Pr(# of causal SNPs is k)   : \n  (0 -> 0)\n   1 -> 0.00308\n   2 -> 0.923\n   3 -> 0.074\n   4 -> 0.000159\n   5 -> 0\n- Run time                         : 0 hours, 0 minutes, 18 seconds\n")),(0,i.kt)("p",null,"There are two bits of information here that allow you to interpret the fine-mapping: the overall\nBayes factor for the region, and the posterior distribution on the number of variants."),(0,i.kt)("p",null,'First, look at the line starting "Log10-BF of >= one causal SNP". This tells us the overall Bayes\nfactor (i.e. the Bayes factor that there is at least one causal variant in the region).'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Log10-BF of >= one causal SNP : 14.3\n")),(0,i.kt)("p",null,"This Bayes factor is very large (over 10",(0,i.kt)("sup",null,"14"),"), and shows that FINEMAP sees clear evidence that there is signal in\nthe region. (This is not surprising, of course, because we started with a region of strong\nassociation.)"),(0,i.kt)("p",null,"Second, let's look at the posterior distribution on the number of causal variants. These occur at\nthe end of the log file on these lines:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"- Post-Pr(# of causal SNPs is k)   : \n  (0 -> 0)\n   1 -> 0.00308\n   2 -> 0.923\n   3 -> 0.074\n   4 -> 0.000159\n   5 -> 0\n")),(0,i.kt)("p",null,"FINEMAP is certain that there are at least two causal variants (as the posterior of k=1, i.e. there\nbeing one variant is very small). And it quite strongly believes (92% posterior) that k = 2, i.e.\nthat there are exactly two causal variants."),(0,i.kt)("h3",{id:"the-causal-configurations-output-file"},"The causal configurations output file"),(0,i.kt)("p",null,"Let's look next at the ",(0,i.kt)("inlineCode",{parentName:"p"},"finemap_meta.config")," file, which list gives the best 50,000 causal\nconfigurations that FINEMAP found in its stochastic search. Load this file into your R session now:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'configurations = read_delim( "finemap_meta.config", delim = " " , comment = "#\')\n')),(0,i.kt)("p",null,"We will look at the ones that have at least a 10% posterior:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"configurations[ configurations$prob > 0.1, ]\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note.")," To print the full details here without truncating columns, I found I had to use ",(0,i.kt)("inlineCode",{parentName:"p"},"print()"),"\nlike this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"print( configurations[ configurations$prob > 0.1, ], width = 100 )\n")),(0,i.kt)("p",null,"As we would expect from the posterior distribution on ",(0,i.kt)("inlineCode",{parentName:"p"},"k"),", all of the higher posterior\nconfigurations include just two variants. In fact all three of them include the variant at position\n",(0,i.kt)("inlineCode",{parentName:"p"},"49208368"),", but they vary a bit by swapping out the second variant in the pair. Note also that the\nsum of the posterior for three causal configurations is only 64%, so while these are the most\nlikely it is also perfectly plausible that the true configuration lies somewhere further down the\nlist."),(0,i.kt)("p",null,"The configuration files can be a bit hard to interpret (and are mostly useful as input for\ndownstream analyses), so we will move on to some slightly easier files to read."),(0,i.kt)("h3",{id:"the-snp-file"},"The SNP file"),(0,i.kt)("p",null,"FINEMAP also outputs the evidence for each individual SNP being causal (regardless of the\nconfiguration).  Let's see how many SNPs have an posterior greater than 10%:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'snps = read_delim( "finemap_meta.snp", delim = " " )\nprint( snps[ snps$prob > 0.1, ], width = 100 )\n')),(0,i.kt)("p",null,"The SNP at position ",(0,i.kt)("inlineCode",{parentName:"p"},"49208368")," has a high posterior (85%), so is quite likely to be causal and you\nwould be quite confident taking this forward for follow-up experiments or further analyses. The\nother variants have posteriors between 19% and 40%, so are reasonable candidates but you wouldn't\nbet the house on any one individually. Instead, if you were designing follow-up experiments based\non this, you would need to consider these variants as a group."),(0,i.kt)("h3",{id:"the-credible-sets-file"},"The credible sets file"),(0,i.kt)("p",null,"To group variants, FINEMAP also provides credible sets for each of the two signals:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'credible = read_delim( "finemap_meta.cred2", delim = " " )\nprint( credible, width = 100 )\n')),(0,i.kt)("p",null,"Also make sure look at the column names:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'> \ncolnames( credible )\n[1] "index" "cred1" "prob1 "cred2" "prob2"\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note.")," My version of the file has trailing spaces at the end of each line - so R warns about\nmissing column names when I load it.  You can safely ignore that."),(0,i.kt)("p",null,"The data in this file shows:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"that the signal that contains the variant at ",(0,i.kt)("inlineCode",{parentName:"p"},"49208368")," has a credible set size of 12 variants\n(the possible variants are listed in the 2nd column).")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"and also that the signal that includes the variant at 49208380 has a credible set size of 4\nvariants (listed in the 4th column)."))),(0,i.kt)("p",null,'This illustrates a counter-intuitive point: even though 49208368 itself has a high posterior, it is\nin LD with a "long tail" of 11 other variants that are in tight LD with each other. The signal that\nincludes 49208380 is not well fine-mapped to a single causal variant, but it does localize well to\na small number of variants (4). So, if you are looking for a single variant that is reasonably\nlikely to be causal, you\'d pick 49208368. But if you were looking for a small set of variants that,\noverall, cover most of the possible causal posterior space, you would pick the second signal.'),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Question")," Using genome browsers, investigate the location and function of these variants. Based on\nthe genetic and the functional information, which variant do you think is most likely to be cauasal\nin each group?"),(0,i.kt)("h2",{id:"plotting-finemap-output"},"Plotting FINEMAP output."),(0,i.kt)("p",null,"In statistics we are never done until the ink is dry on our plot. Let's make a hitplot that (like\nour GWAS practical hitplot) shows the marginal evidence at each SNP, but colours the SNPs according\nto what credible set they fall in.  "),(0,i.kt)("p",null,"First we have to reconstruct the marginal SNP P-value from the effect size and standard error (or z-score),\nsince FINEMAP doesn't output the P-value:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"snps$pvalue = 2 * pnorm( -abs(snps$z ))\n")),(0,i.kt)("p",null,"Next let's define the colours for our credible sets:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'colours = c( "chocolate1", "deepskyblue4" )\nsnps$colour <- "grey"\nsnps$colour[ snps$rsid %in% credible[[\'cred1\']] ] <- colours[1]\nsnps$colour[ snps$rsid %in% credible[[\'cred2\']] ] <- colours[2]\n')),(0,i.kt)("p",null,"Also let's load genes using the same data / code from the ",(0,i.kt)("a",{parentName:"p",href:"../GWAS_analysis_practical"},"GWAS\npractical"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'genes <- read.table( "resources/refGene_chr19.txt.gz", header=T, as.is=T )\n')),(0,i.kt)("p",null,"Now here's a function that makes the plot:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'plot.finemap.output <- function( snps, credible, xrange = NULL ) {\n  # Two big panels and a small one for genes\n  layout( matrix( 1:3, ncol = 1 ), heights = c( 1, 0.75, 0.75 ))\n\n  if( is.null( xrange )) {\n    xrange = range( snps$position )\n  }\n  # Plot the per-SNP evidence\n  par( mar = c( 0.1, 4, 1, 1 ))\n  plot(\n    snps$position,\n    -log10( snps$pvalue ),\n    xlab = "Position",\n    ylab = "-log10(P-value)",\n    col = snps$colour,\n    pch = 19,\n    xaxt = \'n\',\n    xlim = xrange,\n    bty = \'n\'            # no box, because I think they\'re ugly!\n  )\n  grid()\n  legend( "topleft", col = colours, pch = 19, legend = sprintf( "Credible set %d", 1:2 ))\n\n  # Plot the posteriors\n  par( mar = c( 0.1, 4, 0.1, 1 ))\n  plot(\n    snps$position,\n    snps$prob,\n    ylab = "Posterior",\n    col = snps$colour,\n    type = "h",          # to plot vertical lines.  See `?plot`.\n    xlim = xrange,\n    xaxt = \'n\',\n    bty = \'n\'            # no box\n  )\n  grid()\n\n  par( mar = c( 4, 4, 0.1, 1 ))\n  plot.genes( genes, xrange, bty = \'n\' )\n  grid()\n}\n')),(0,i.kt)("p",null,"Run it like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"plot.finemap.output( snps, credible )\n")),(0,i.kt)("p",null,"and inspect it.  You can also zoom in to see how the evidence stacks up over the genes:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"plot.finemap.output( snps, credible, xrange = c( 49190000, 49229999 ) )\n")),(0,i.kt)("p",null,"It should look something like this:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"img",src:n(3502).Z,width:"1800",height:"1200"})),(0,i.kt)("h2",{id:"conclusion"},"Conclusion"),(0,i.kt)("p",null,"Congratulations!  You have fine-mapped your GWAS signal!"))}c.isMDXComponent=!0},4926:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/files/study_LD-7240737f948f325c4f01f2f2cc916f38.ld"},3502:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/finemap_plot_zoom-41d6bda3fe3270436c7241d8c705ca5f.png"}}]);