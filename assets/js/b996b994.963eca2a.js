"use strict";(self.webpackChunkwhg_training_resources=self.webpackChunkwhg_training_resources||[]).push([[3592],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),p=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=p(a),u=i,h=m["".concat(l,".").concat(u)]||m[u]||d[u]||r;return a?n.createElement(h,s(s({ref:t},c),{},{components:a})):n.createElement(h,s({ref:t},c))}));function h(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,s=new Array(r);s[0]=u;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[m]="string"==typeof e?e:i,s[1]=o;for(var p=2;p<r;p++)s[p]=a[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},9279:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>p});var n=a(7462),i=(a(7294),a(3905));const r={sidebar_position:2},s="Getting setup",o={unversionedId:"population_genetics/admixture_and_biobanks/getting_setup",id:"population_genetics/admixture_and_biobanks/getting_setup",title:"Getting setup",description:"Download data",source:"@site/docs/population_genetics/admixture_and_biobanks/getting_setup.md",sourceDirName:"population_genetics/admixture_and_biobanks",slug:"/population_genetics/admixture_and_biobanks/getting_setup",permalink:"/whg-training-resources/population_genetics/admixture_and_biobanks/getting_setup",draft:!1,editUrl:"https://github.com/whg-training/whg-training-resources/edit/main/docs/population_genetics/admixture_and_biobanks/getting_setup.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"sidebar7",previous:{title:"Population structure and admixture",permalink:"/whg-training-resources/population_genetics/admixture_and_biobanks/"},next:{title:"Fst",permalink:"/whg-training-resources/population_genetics/admixture_and_biobanks/fst"}},l={},p=[{value:"Download data",id:"download-data",level:2},{value:"Perform LD Pruning in PLINK",id:"perform-ld-pruning-in-plink",level:2},{value:"Computing principal components",id:"computing-principal-components",level:2},{value:"Loading the genotype data",id:"loading-the-genotype-data",level:2},{value:"Re-coding the genotype data",id:"re-coding-the-genotype-data",level:2}],c={toc:p},m="wrapper";function d(e){let{components:t,...a}=e;return(0,i.kt)(m,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"getting-setup"},"Getting setup"),(0,i.kt)("h2",{id:"download-data"},"Download data"),(0,i.kt)("p",null,"To get set up, start in the terminal.  Make a new folder, say ",(0,i.kt)("inlineCode",{parentName:"p"},"admixture"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"cd")," into it:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"mkdir admixture\ncd admixture\n")),(0,i.kt)("p",null,"Now download the needed data as follows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"# chromosome 21 only\ncurl -O https://tinyurl.com/45c6f2na/ALL.chr21.phase3_shapeit2_mvncall_integrated_v5b.20130502.genotypes.vcf.gz\n\n# index file\ncurl -O https://tinyurl.com/45c6f2na/ALL.chr21.phase3_shapeit2_mvncall_integrated_v5b.20130502.genotypes.vcf.gz.tbi\n\n# population file\ncurl -O https://tinyurl.com/45c6f2na/integrated_call_samples_v3.20130502.ALL.panel\n")),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The data comes from the 1000 Genomes Project - specifically ",(0,i.kt)("a",{parentName:"p",href:"https://ftp.1000genomes.ebi.ac.uk/vol1/ftp/release/20130502"},"this FTP folder"),".  If your platform doesn't have ",(0,i.kt)("inlineCode",{parentName:"p"},"curl"),", try ",(0,i.kt)("inlineCode",{parentName:"p"},"wget")," instead, e.g.:"),(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre"},"wget https://tinyurl.com/45c6f2na/integrated_call_samples_v3.20130502.ALL.panel\n")))),(0,i.kt)("p",null,"You will also need to get hold of ",(0,i.kt)("a",{parentName:"p",href:"https://www.cog-genomics.org/plink/2.0/"},"plink"),". We'll use plink 2.0 'alpha' for this practical.  Pick the appropriate version for your platform, download it, unzip it, and copy the ",(0,i.kt)("inlineCode",{parentName:"p"},"plink2")," executable into the current folder."),(0,i.kt)("h2",{id:"perform-ld-pruning-in-plink"},"Perform LD Pruning in PLINK"),(0,i.kt)("p",null,"To avoid the strong influence of SNP clusters in principal component analysis and relatedness analysis, we will use a pruned (independent) set of SNPs.  Specifically let's get SNPs that are thinned to have LD ",(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("msup",{parentName:"mrow"},(0,i.kt)("mi",{parentName:"msup"},"r"),(0,i.kt)("mn",{parentName:"msup"},"2")),(0,i.kt)("mo",{parentName:"mrow"},"<"),(0,i.kt)("mn",{parentName:"mrow"},"0.1")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"r^2 < 0.1")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8532em",verticalAlign:"-0.0391em"}}),(0,i.kt)("span",{parentName:"span",className:"mord"},(0,i.kt)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.02778em"}},"r"),(0,i.kt)("span",{parentName:"span",className:"msupsub"},(0,i.kt)("span",{parentName:"span",className:"vlist-t"},(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141em"}},(0,i.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,i.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mtight"},"2")))))))),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.kt)("span",{parentName:"span",className:"mrel"},"<"),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}})),(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.6444em"}}),(0,i.kt)("span",{parentName:"span",className:"mord"},"0.1")))))," in a defined window size (50 variants, 10 variants each step):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"./plink2 --vcf ALL.chr21.phase3_shapeit2_mvncall_integrated_v5b.20130502.genotypes.vcf.gz \\\n--double-id --snps-only \\\n--set-missing-var-ids @:#\\$r,\\$a \\\n--maf 0.01 \\\n--indep-pairwise 50 10 0.1 \\\n--out g1k_pruned\n")),(0,i.kt)("p",null,"This is similar to the command used in the ",(0,i.kt)("a",{parentName:"p",href:"/whg-training-resources/population_genetics/principal_components_analysis/"},"PCA practical"),".  In the above command:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"--vcf")," is to read from a vcf file")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"--double-id")," causes both family and individual IDs to be set to the sample ID, this is typically required by the PLINK ",(0,i.kt)("inlineCode",{parentName:"p"},"fam")," format, but in here, both individual and family ID are the same")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"--snps-only")," excludes all variants with one or more multi-character allele codes. With 'just-acgt', variants with single-character allele codes outside of {'A', 'C', 'G', 'T', 'a', 'c', 'g', 't', \\<missing code",">","} are also excluded.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"--set-missing-var-ids @:#\\$r,\\$a")," if the ID filed of the variant is missing (usually written as '.') in the vcf file, we can fill the variant name based on the chromosome, genomic position, reference (r) and alternative (a) allele. The command here would name, for example, a variant 'chr1:10583G,A'. Note the extra backslashes: they are necessary in bash because '$' is a reserved character there")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"--maf 0.01")," is to filter any variant with minor allele frequency <1%")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"--indep-pairwise 50 10 0.1"),"  This is the command to perform pruning! It considers correlations between unphased-hardcall allele counts. It takes three parameters: a required window size in variant count or kilobase (if the 'kb' modifier is present) units, an optional variant count to shift the window at the end of each step, and a required r2 threshold. At each step, pairs of variants in the current window with squared correlation greater than the threshold are noted, and variants are greedily pruned from the window until no such pairs remain."))),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This type of 'LD pruning' is common.  However you should be aware that it can ",(0,i.kt)("strong",{parentName:"p"},"change the frequency distribution of the variants in your data"),".  (This is because rarer SNPs tend to have lower LD levels).  "),(0,i.kt)("p",{parentName:"div"},"For extra kudos, use ",(0,i.kt)("inlineCode",{parentName:"p"},"plink --freq")," to compute the frequency of variants before and after pruning above, and then plot their histograms in R - are they similar?"),(0,i.kt)("p",{parentName:"div"},"Another way to thin variants is simply to thin by distance, or by genetic distance."))),(0,i.kt)("h2",{id:"computing-principal-components"},"Computing principal components"),(0,i.kt)("p",null,"Now let's extract the pruned (independent) variants and perform PCA:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"./plink2 --vcf ALL.chr21.phase3_shapeit2_mvncall_integrated_v5b.20130502.genotypes.vcf.gz \\\n--double-id --snps-only --max-alleles 2 \\\n--set-missing-var-ids @:#\\$r,\\$a \\\n--extract g1k_pruned.prune.in \\\n--export vcf \\\n--pca \\\n--out g1k_chr21_pruned\n")),(0,i.kt)("p",null,"In this command:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"--max-alleles 2")," includes only biallelic variants"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"--extract")," tells plink to only work with post-pruning variants"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"--export")," outputs a vcf file"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"--pca")," perform principal component analysis. It extracts top principal components from the variance-standardized relationship matrix computed by ",(0,i.kt)("inlineCode",{parentName:"p"},"--make-rel/--make-grm-{bin,list}"),". "),(0,i.kt)("p",null,"We expect three output files from this step:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"a pruned vcf file: ",(0,i.kt)("inlineCode",{parentName:"p"},"g1k_chr21_pruned.vcf")," (this file should contain 22,452 variants)")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"g1k_chr21.eigenvec")," file contains the requested number (10) of principal components (PCs) ")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"g1k_chr21.eigenval")," file contains the corresponding eigenvalues, one per line. "))),(0,i.kt)("h2",{id:"loading-the-genotype-data"},"Loading the genotype data"),(0,i.kt)("p",null,"Lastly let's convert some genotype data from vcf format (standard, but hard to work with) into a .tsv file for easier downstream work. To do this we will use the ",(0,i.kt)("inlineCode",{parentName:"p"},"vcfR")," package, let's get that now.  It resides in ",(0,i.kt)("a",{parentName:"p",href:"https://bioconductor.org"},"bioconductor")," so we'll use ",(0,i.kt)("inlineCode",{parentName:"p"},"BiocManager")," to get it:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-r"},'# List of packages you will need for this course\npackages <- c( "vcfR", "tidyverse" )\n\n# Install packages if they aren\'t installed already\n# We are \nnew_packages <- packages[!(packages %in% installed.packages()[,"Package"])]\nif (!requireNamespace("BiocManager", quietly=TRUE))\n    install.packages("BiocManager")\n\n# using BiocManager to install packages\nif(length(new_packages)) BiocManager::install(new_packages)\n\n# Load the packages\nlapply( packages, library, character.only = TRUE )\n')),(0,i.kt)("p",null,"Make sure your R session is pointing at the current directory (where you downloaded the data) using ",(0,i.kt)("inlineCode",{parentName:"p"},"setwd()")," or the Sessino menu in Rstudio, and let's load the data:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-r"},'vcf_file <- "g1k_chr21_pruned.vcf"\nchr21 <- read.vcfR( vcf_file, verbose = FALSE )\ndim(chr21)\n')),(0,i.kt)("h2",{id:"re-coding-the-genotype-data"},"Re-coding the genotype data"),(0,i.kt)("p",null,"Since ",(0,i.kt)("inlineCode",{parentName:"p"},".vcf")," files have a lot information included that isn\u2019t necessary for our analysis, we will extract the genotypes and convert it into a form that we can easily use in R. So, here, we extract the character data containing the genotypes, and convert it into numeric scores that we can later use in our analysis."),(0,i.kt)("p",null,"If you've looked at a VCF file you'll know they can be a bit complex - luckily the ",(0,i.kt)("inlineCode",{parentName:"p"},"vcfR")," package has a ",(0,i.kt)("inlineCode",{parentName:"p"},"vcfR::extract.gt()")," function that can do the work for us:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-r"},'chr21_common_geno <- vcfR::extract.gt(\n    chr21, \n    element = "GT",\n    IDtoRowNames  = FALSE,\n    as.numeric = TRUE,\n    convertNA = TRUE,\n    return.alleles = FALSE\n)\n')),(0,i.kt)("p",null,"For this analysis we will subset down to 10,000 SNPs to maek the analysis run smoothly.\nFor simplicity we'll just go ahead and pick these at random, and save the results:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"idx <- sample( 1:nrow(chr21_common_geno), size = 10000 )\n")),(0,i.kt)("p",null,"and let's save it:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-r"},'library( tidyverse )\nwrite_delim(\n    as_tibble(chr21_common_geno[idx,]),\n    file = "g1k_common_genotypes.txt",\n    delim = " "\n)\n')),(0,i.kt)("p",null,"You can look at this file using, for example, ",(0,i.kt)("inlineCode",{parentName:"p"},"less -S")," in your terminal to see what it looks like. In short we've stored just the genotype dosages (dosage of the alternate allele, i.e. 0, 1, or 2) for each of our selected SNPs and all 2,504 samples in the 1000 Genomes Project data."))}d.isMDXComponent=!0}}]);