"use strict";(self.webpackChunkwhg_training_resources=self.webpackChunkwhg_training_resources||[]).push([[4720],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=p(n),d=o,h=m["".concat(l,".").concat(d)]||m[d]||u[d]||i;return n?a.createElement(h,r(r({ref:t},c),{},{components:n})):a.createElement(h,r({ref:t},c))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:o,r[1]=s;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6175:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var a=n(7462),o=(n(7294),n(3905));const i={sidebar_position:5},r="Removing closely-related samples",s={unversionedId:"population_genetics/principal_components_analysis/relatedness_pruning",id:"population_genetics/principal_components_analysis/relatedness_pruning",title:"Removing closely-related samples",description:"Up to the table of contents - Back to the page on LD pruning - Forward to compute the PCs",source:"@site/docs/population_genetics/principal_components_analysis/relatedness_pruning.md",sourceDirName:"population_genetics/principal_components_analysis",slug:"/population_genetics/principal_components_analysis/relatedness_pruning",permalink:"/whg-training-resources/population_genetics/principal_components_analysis/relatedness_pruning",draft:!1,editUrl:"https://github.com/whg-training/whg-training-resources/edit/main/docs/population_genetics/principal_components_analysis/relatedness_pruning.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"sidebar7",previous:{title:"Removing highly-correlated SNPs",permalink:"/whg-training-resources/population_genetics/principal_components_analysis/ld_pruning"},next:{title:"Computing principal components",permalink:"/whg-training-resources/population_genetics/principal_components_analysis/computing_PCs"}},l={},p=[{value:"Picking samples to exclude",id:"picking-samples-to-exclude",level:4},{value:"Computing principal components",id:"computing-principal-components",level:4}],c={toc:p},m="wrapper";function u(e){let{components:t,...n}=e;return(0,o.kt)(m,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"removing-closely-related-samples"},"Removing closely-related samples"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"Introduction.md"},"Up to the table of contents")," - ",(0,o.kt)("a",{parentName:"p",href:"/whg-training-resources/population_genetics/principal_components_analysis/ld_pruning"},"Back to the page on LD pruning")," - ",(0,o.kt)("a",{parentName:"p",href:"/whg-training-resources/population_genetics/principal_components_analysis/computing_PCs"},"Forward to compute the PCs")),(0,o.kt)("p",null,"We want our top PCs to reflect the relatedness structure across the majority of samples in our GWAS dataset.\nAlthough all samples in our dataset are nominally unrelated, a few duplicated or related samples may have\nslipped in through the sampling process or through sample handling. As with correlated SNPs, this can seriously\naffect principal components. We'll therefore first identify and remove any close relationships before computing\nPCs."),(0,o.kt)("p",null,"Let's use plink to compute the relatedness between samples. A simple way to do this would be to use\nthe relatedness matrix that we will construct to compute PCA. However, here we'll use genome-wide\nestimates of identity by descent (IBD) instead. To do this we use the following command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"plink --vcf chr19-clean.vcf.gz --genome gz --out chr19-clean --extract chr19-clean.prune.in\n")),(0,o.kt)("p",null,"Here, the ",(0,o.kt)("inlineCode",{parentName:"p"},"--genome")," option tells plink to compute genome-wide IBD estimates (as this file is rather large, we ask plink to store it in a gzipped file).  We've used the ",(0,o.kt)("inlineCode",{parentName:"p"},"--extract")," option to tell plink to only use the LD-pruned set of SNPs we computed above.  Further details of the options for computing relatedness and file formats are described ",(0,o.kt)("a",{parentName:"p",href:"https://www.cog-genomics.org/plink2/ibd"},"on the plink documentation page"),"."),(0,o.kt)("p",null,"The output file from the command above is in ",(0,o.kt)("inlineCode",{parentName:"p"},"chr19-clean.genome.gz"),". Let's load that into ",(0,o.kt)("inlineCode",{parentName:"p"},"R"),"\nand have a look at it."),(0,o.kt)("p",null,"In R/RStudio:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-R"},'ibd <- read.table("chr19-clean.genome.gz", hea=T, as.is=T)\nView(ibd)\nhist( ibd$PI_HAT, breaks = 100 )\n')),(0,o.kt)("p",null,"You can also zoom in along the y-axis to see any close relationships:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-R"},"hist( ibd$PI_HAT, breaks = 100, ylim = c(0,1000) )\n")),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Questions")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},(0,o.kt)("strong",{parentName:"p"},"Question"),". What is ",(0,o.kt)("inlineCode",{parentName:"p"},"PI_HAT"),"? Can you figure it out from ",(0,o.kt)("a",{parentName:"p",href:"https://www.cog-genomics.org/plink2/ibd"},"the documentation\npage"),"?"),(0,o.kt)("p",{parentName:"div"},(0,o.kt)("strong",{parentName:"p"},"Question"),". Which samples have the closest relationship in the dataset?  What is the average relationship between samples in this dataset?"),(0,o.kt)("p",{parentName:"div"},(0,o.kt)("strong",{parentName:"p"},"Question"),". In the histogram, there's a tail or 'bump' of relationships up to about 0.2.  What could this represent?"))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note.")," The above is only one way to compute relatedness estimates - many other methods are available.\nFor example, ",(0,o.kt)("a",{parentName:"p",href:"https://www.kingrelatedness.com"},"KING")," is a popular choice.  More computationally demanding methods also exist that can ",(0,o.kt)("a",{parentName:"p",href:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7553009/"},"identify actual segments inherited IBD"),"."),(0,o.kt)("h4",{id:"picking-samples-to-exclude"},"Picking samples to exclude"),(0,o.kt)("p",null,"Before we compute PCs, we'll pick one sample from each closely-related pair and exclude it. For\nnow we'll just do this simply by picking the second sample; a more refined approach might look at\ngenotyping performance across the genome and exclude the sample with greater missingness. (Better\nyet, you could try to pick the fewest number of samples that remove all close relationships, as\nthis can sometimes substantially improve the resulting sample size). We'll store the results in a\nfile that we can tell plink about in later steps."),(0,o.kt)("p",null,"In RStudio:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-R"},"# put a line on our plot so we can see what we'll exclude\nabline( v = 0.2, col = 'red' )\n\n# Write a list of excluded samples\nexclusions = ibd[ ibd$PI_HAT > 0.2, c('FID2','IID2') ]\nwrite.table( exclusions, file=\"related_samples.txt\", col.names = F, row.names = F, quote = F )\n")),(0,o.kt)("p",null,"Q. How many samples will be excluded?"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note"),": the same sample might appear twice in the exclusions data frame.  This would happen if they are closely related to more than one other sample.  Are there any samples like that?  You can use ",(0,o.kt)("inlineCode",{parentName:"p"},"unique(exclusions)")," to get a list of unique samples to exclude."),(0,o.kt)("h4",{id:"computing-principal-components"},"Computing principal components"),(0,o.kt)("p",null,"When you're ready, go ",(0,o.kt)("a",{parentName:"p",href:"/whg-training-resources/population_genetics/principal_components_analysis/computing_PCs"},"here")," to start the principal component analysis proper."))}u.isMDXComponent=!0}}]);